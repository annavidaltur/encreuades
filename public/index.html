<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Encreuada | Mots encreuats en valencià</title>
	<link rel="icon" href="assets/icons/favicon.ico" />
	<link rel="apple-touch-icon" href="assets/icons/apple-touch-icon.png" />

	<!-- Fonts -->
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,400;0,700;0,900;1,300;1,400;1,700;1,900&display=swap" rel="stylesheet">

	<!-- Bootstrap CSS -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">


	<!-- Estils -->
	<link rel="stylesheet" href="assets/style.css">
</head>
<body class="bg-light">

<div class="main-content">

	<!-- Títol -->
	<div class="titolDivertit mx-auto" onclick="mostrarPrincial()">
		<svg id="square" viewBox="0 0 700 50" preserveAspectRatio="xMidYMid meet">
			<g transform="translate(0,0)">
				<rect class="letter" height="50" width="50"></rect>
				<text x="25" y="35" font-family="Helvetica" text-anchor="middle" font-size="25" fill="#450359">M</text>
			</g>
			<g transform="translate(50,0)">
				<rect class="letter" height="50" width="50"></rect>
				<text x="25" y="35" font-family="Helvetica" text-anchor="middle" font-size="25" fill="#450359">O</text>
			</g>
			<g transform="translate(100,0)">
				<rect class="letter" height="50" width="50"></rect>
				<text x="25" y="35" font-family="Helvetica" text-anchor="middle" font-size="25" fill="#450359">T</text>
			</g>
			<g transform="translate(150,0)">
				<rect class="letter" height="50" width="50"></rect>
				<text x="25" y="35" font-family="Helvetica" text-anchor="middle" font-size="25" fill="#450359">S</text>
			</g>

			<g transform="translate(200,0)">
				<rect height="50" width="50" stroke-width="2" stroke="#333333" fill="#333333"></rect>
			</g>

			<g transform="translate(250,0)">
				<rect class="letter" height="50" width="50"></rect>
				<text x="25" y="35" font-family="Helvetica" text-anchor="middle" font-size="25" fill="#450359">E</text>
			</g>
			<g transform="translate(300,0)">
				<rect class="letter" height="50" width="50"></rect>
				<text x="25" y="35" font-family="Helvetica" text-anchor="middle" font-size="25" fill="#450359">N</text>
			</g>
			<g transform="translate(350,0)">
				<rect class="letter" height="50" width="50"></rect>
				<text x="25" y="35" font-family="Helvetica" text-anchor="middle" font-size="25" fill="#450359">C</text>
			</g>
			<g transform="translate(400,0)">
				<rect class="letter" height="50" width="50"></rect>
				<text x="25" y="35" font-family="Helvetica" text-anchor="middle" font-size="25" fill="#450359">R</text>
			</g>
			<g transform="translate(450,0)">
				<rect class="letter" height="50" width="50"></rect>
				<text x="25" y="35" font-family="Helvetica" text-anchor="middle" font-size="25" fill="#450359">E</text>
			</g>
			<g transform="translate(500,0)">
				<rect class="letter" height="50" width="50"></rect>
				<text x="25" y="35" font-family="Helvetica" text-anchor="middle" font-size="25" fill="#450359">U</text>
			</g>
			<g transform="translate(550,0)">
				<rect class="letter" height="50" width="50"></rect>
				<text x="25" y="35" font-family="Helvetica" text-anchor="middle" font-size="25" fill="#450359">A</text>
			</g>
			<g transform="translate(600,0)">
				<rect class="letter" height="50" width="50"></rect>
				<text x="25" y="35" font-family="Helvetica" text-anchor="middle" font-size="25" fill="#450359">T</text>
			</g>
			<g transform="translate(650,0)">
				<rect class="letter" height="50" width="50"></rect>
				<text x="25" y="35" font-family="Helvetica" text-anchor="middle" font-size="25" fill="#450359">S</text>
			</g>
		</svg>
	</div>

	<p class="text-center">Tria el teu repte </p>

	<!-- Enllaços -->
	<div class="container-fluid d-flex justify-content-center gap-2 my-4">
		<button id="btnXicotets" class="btn btn-crossword px-4 py-2" onclick="mostrarMots('xicotets')">Crossetes</button>
		<button id="btnGrans" class="btn btn-crossword-outline px-4 py-2" onclick="mostrarMots('grans')">Crossots</button>
	</div>


	<div id="puzzleSelect"></div>
  	<div id="board"></div>
  
	<script>
		async function carregarPuzzles() {
		const res = await fetch("/api/crosswords");
		const puzzles = await res.json();
		const select = document.getElementById("puzzleSelect");
		puzzles.forEach(puzzle => {
			const puzDiv = document.createElement("div");
			puzDiv.classList.add("puzDiv");

			// part esquerra
			const left = document.createElement("div");
			left.classList.add("puzLeft");

			// imatge
			const left1 = document.createElement("div");
			const img = document.createElement("img");
			img.src="assets/icons/web-app-manifest-512x512.png"
			img.classList.add("puzIcon");
			left1.appendChild(img);

			// data
			const left2 = document.createElement("div");
			const date = document.createElement("p");
			date.classList.add("pDate");
			const puzzleDate = new Date(puzzle.date);
			date.textContent = puzzleDate.toLocaleDateString("ca-ES", {day: "numeric", month: "long", year: "numeric"});
			left2.appendChild(date);

			// títol + author
			const sp = document.createElement("span");
			sp.classList.add("spTitleAuthor");
			sp.textContent = puzzle.title + " / " + puzzle.author;
			left2.appendChild(sp);

			// afegir titol i author a divPuz
			left.appendChild(left1)
			left.appendChild(left2);

			// icona >
			const arrow = document.createElement("span");
			arrow.classList.add("puzArrow");
			arrow.textContent = "›";

			// muntar puzDiv
			puzDiv.appendChild(left);
			puzDiv.appendChild(arrow);
			puzDiv.value = puzzle.id;

			// event onclick
			puzDiv.addEventListener("click", e => clickPuzzle(e.target.value));

			// afegir divPuz al divParent
			select.appendChild(puzDiv);
		});
		select.addEventListener("change", e => carregarPuzzle(e.target.value));
		}		

		async function clickPuzzle(id) {
			console.log("CLIK puzzle:", id);
			document.getElementById("puzzleSelect").style.display = "none";
			document.getElementById("board").style.display = "block";

			const res = await fetch("/api/crossword/" + id);
			const data = await res.json();
			buildPuzzle(data);
		}

		// carregarPuzzles();
		clickPuzzle("20250731")

		function buildPuzzle(data){
			const board = document.getElementById("board");
			board.innerHTML = "";
			
			const width = data.dimensions.width;
			const height = data.dimensions.height;
			const puzzle = data.puzzle;

			board.style.display = "grid";
			board.style.gridTemplateColumns = `repeat(${width}, 40px)`;
			board.style.gridTemplateRows = `repeat(${height}, 40px)`;

			for(let i = 0; i < width; i++){
				for(let j = 0; j < height; j++){
					const cell = document.createElement("div");
					const puzContent = puzzle[i][j];
					
					// estil
					cell.classList.add("cell");
					if(i == 0)
						cell.classList.add("firstRow");
					if(j == 0)
						cell.classList.add("firstCol");
					
					// afegir número de paraula
					if(puzContent == "#") // black square
						cell.classList.add("cellBlack")
					else if(puzContent > 0) // número de pista
					{
						const nPista = document.createElement("span");
						nPista.classList.add("nPista");
						nPista.innerText = puzContent;
						cell.appendChild(nPista)
					}	
					// const cellLetter = document.createElement("span");
					// cellLetter.innerText = i + "," + j;
					// cell.appendChild(cellLetter)
					board.appendChild(cell)
				}
			}
			// for(let i = 0; i < width * height; i++){
			// 	const cell = document.createElement("div");
			// 	cell.classList.add("cell");
			// 	cell.innerText = i;
			// 	board.appendChild(cell)
			// }
		}
	</script>

</div>

<!-- Footer -->
<footer class="footer">© 2025 Anna</footer>

<script>
function mostrarMots(id) {
	document.getElementById("puzzleSelect").style.display = "block"


	document.getElementById('xicotets').style.display = 'none';
	document.getElementById('grans').style.display = 'none';
	document.getElementById(id).style.display = 'block';

	//document.getElementById('btnXicotets').style.display = 'none';
	//document.getElementById('btnGrans').style.display = 'none';
	document.getElementById('footer').style.display = 'none';
}

function mostrarPrincial() {
	document.getElementById("puzzleSelect").style.display = "block"

	document.getElementById('xicotets').style.display = 'none';
	document.getElementById('grans').style.display = 'none';
	document.getElementById('btnXicotets').style.display = 'block';
	document.getElementById('btnGrans').style.display = 'block';
	document.getElementById('footer').style.display = 'block';
}
</script>


	<!-- Bootstrap JS -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
</body>
</html>
